<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏£‡∏∞‡∏ö‡∏ö "‡πÄ‡∏à‡∏≤‡∏∞‡∏Ç‡πà‡∏≤‡∏ß" ‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ (PR-Crisis Sentinel)</title>
    <!-- ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ JavaScript ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö -->
    <style>
      :root {
        --primary-color: #3498db;
        --secondary-color: #2c3e50;
        --background-color: #ecf0f1;
        --card-bg-color: #ffffff;
        --text-color: #34495e;
        --header-color: #2c3e50;
        --danger-color: #e74c3c;
        --success-color: #2ecc71;
        --warning-color: #f39c12;
      }
      body {
        font-family: "Sarabun", sans-serif;
        background: linear-gradient(135deg, #eaf2f8, #e8f6f3);
        padding: 20px;
        color: var(--text-color);
        margin: 0;
      }
      .main-container {
        max-width: 1200px;
        margin: auto;
      }
      h1 {
        text-align: center;
        color: var(--header-color);
        line-height: 1.4;
      }
      h1 small {
        font-size: 0.6em;
        color: #566573;
      }
      h3 {
        text-align: center;
        color: var(--header-color);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
      }
      .header .logo {
        width: 100px;
        height: auto;
        margin-bottom: 15px;
      }
      .nav-link {
        color: var(--primary-color);
        text-decoration: none;
        margin: 0 15px;
        font-weight: bold;
        transition: color 0.3s;
      }
      .nav-link:hover {
        color: var(--secondary-color);
      }
      .search-form-container {
        text-align: center;
        margin-bottom: 40px;
      }
      .search-form {
        position: relative;
        display: inline-block;
      }
      .search-form input {
        font-size: 1em;
        padding: 15px 25px;
        width: 350px;
        border: 1px solid #dfe6e9;
        border-radius: 30px;
        padding-right: 60px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }
      .search-form button[type="submit"] {
        font-size: 1em;
        padding: 12px 25px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        margin-left: 10px;
        transition: background-color 0.3s;
        box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
      }
      .search-form button[type="submit"]:hover {
        background-color: #2980b9;
      }
      #mic-button {
        position: absolute;
        right: 135px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        font-size: 1.5em;
        cursor: pointer;
        color: #b2bec3;
        padding: 0 10px;
        transition: color 0.3s;
      }
      #mic-button:hover {
        color: var(--primary-color);
      }
      #mic-button.recording {
        color: var(--danger-color);
      }
      .results-header {
        text-align: center;
        font-size: 1.8em;
        margin-bottom: 20px;
        color: var(--header-color);
      }
      .charts-container {
        display: flex;
        justify-content: center;
        gap: 30px;
        flex-wrap: wrap;
        margin-bottom: 40px;
        align-items: flex-start;
      }
      .card {
        background-color: var(--card-bg-color);
        border-radius: 16px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        padding: 25px;
        border-top: 4px solid var(--primary-color);
        transition: transform 0.3s, box-shadow 0.3s;
      }
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
      }
      .chart-card,
      .keyword-card,
      .trend-card {
        width: 100%;
        max-width: 360px;
      }
      .wordcloud-card {
        width: 100%;
        max-width: 1140px;
        border-top-color: var(--danger-color);
      }
      .wordcloud-card img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 20px auto 0;
      }
      .keyword-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin-top: 15px;
      }
      .keyword-tag {
        background-color: var(--danger-color);
        color: white;
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 0.9em;
      }
      .trend-card .trend-text {
        font-size: 1.5em;
        font-weight: bold;
        text-align: center;
        margin-top: 20px;
      }
      .trend-alert {
        color: var(--danger-color);
      }
      .trend-good {
        color: var(--success-color);
      }
      .trend-normal {
        color: var(--text-color);
      }
      table {
        width: 100%;
        border-collapse: collapse;
        background-color: var(--card-bg-color);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border-radius: 12px;
        overflow: hidden;
      }
      th,
      td {
        padding: 15px;
        border-bottom: 1px solid #ecf0f1;
        text-align: left;
      }
      th {
        background-color: #f8f9fa;
        font-weight: bold;
        color: var(--header-color);
      }
      tr:nth-child(even) {
        background-color: #fdfdfd;
      }
      tr:hover {
        background-color: #f1f8ff;
      }
      .sentiment-POSITIVE {
        color: var(--success-color);
        font-weight: bold;
      }
      .sentiment-NEGATIVE {
        color: var(--danger-color);
        font-weight: bold;
      }
      .sentiment-NEUTRAL {
        color: #7f8c8d;
        font-weight: bold;
      }
      .tooltip {
        position: relative;
        display: inline-block;
        cursor: pointer;
      }
      .tooltip .tooltip-text {
        visibility: hidden;
        width: 220px;
        background-color: #555;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 8px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -110px;
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.8em;
        font-weight: normal;
      }
      .tooltip:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
      }
      .tooltip-icon {
        font-size: 0.8em;
        border: 1px solid #ccc;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        display: inline-flex;
        justify-content: center;
        align-items: center;
      }
      .table-container h3 {
        display: block;
      }
      .table-summary {
        text-align: center;
        margin-bottom: 20px;
        font-size: 1.1em;
        color: #555;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 8px;
      }
      .table-summary span {
        margin: 0 15px;
      }
      .top-buttons-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
        margin-bottom: 40px;
      }
      .action-btn {
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 25px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }
      .action-btn:hover {
        transform: translateY(-2px);
      }
      .exec-summary-btn {
        background: linear-gradient(45deg, #1abc9c, #16a085);
        box-shadow: 0 4px 8px rgba(26, 188, 156, 0.3);
      }
      .simulation-btn {
        background: linear-gradient(45deg, #f39c12, #e67e22);
        box-shadow: 0 4px 8px rgba(243, 156, 18, 0.3);
      }
      .root-cause-btn {
        background: linear-gradient(45deg, #34495e, #2c3e50);
        box-shadow: 0 4px 8px rgba(52, 73, 94, 0.3);
      }

      @media (max-width: 768px) {
        .charts-container {
          flex-direction: column;
          align-items: center;
        }
        .card {
          max-width: 90%;
        }
        .search-form input {
          width: 70%;
        }
        #mic-button {
          right: 110px;
        }
      }
      #loader-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        z-index: 9999;
      }
      .loader {
        border: 8px solid #f3f3f3;
        border-top: 8px solid var(--primary-color);
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1.5s linear infinite;
        margin-bottom: 20px;
      }
      #loader-overlay p {
        font-size: 1.2em;
        color: var(--secondary-color);
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .pagination-container {
        text-align: center;
        margin-top: 30px;
      }
      .pagination-btn {
        background-color: white;
        border: 1px solid #ddd;
        color: var(--primary-color);
        padding: 8px 16px;
        text-decoration: none;
        cursor: pointer;
        margin: 0 4px;
        border-radius: 4px;
        transition: background-color 0.3s;
      }
      .pagination-btn:hover {
        background-color: var(--primary-color);
        color: white;
      }
      .pagination-btn.active {
        background-color: var(--primary-color);
        color: white;
        font-weight: bold;
      }
      .pagination-btn.disabled {
        color: #ccc;
        cursor: not-allowed;
        background-color: #f9f9f9;
      }
      .site-footer {
        text-align: center;
        margin-top: 50px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
        color: #95a5a6;
        font-size: 0.9em;
      }
      .ai-assistant-btn {
        background: linear-gradient(45deg, #e67e22, #d35400);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 25px;
        font-size: 1em;
        font-weight: bold;
        cursor: pointer;
        margin-top: 15px;
        transition: transform 0.2s;
      }
      .ai-assistant-btn:hover {
        transform: translateY(-2px);
      }
      .swal2-html-container {
        text-align: left !important;
        white-space: pre-wrap;
      }
    </style>
    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="loader-overlay">
      <div class="loader"></div>
      <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
    </div>

    <div class="main-container">
      <div class="header">
        <img
          src="https://img2.pic.in.th/pic/d7148bd48bd930bf925897e1884e2b82.png"
          alt="Project Logo"
          class="logo"
        />
        <h1>
          üõ°Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö "‡πÄ‡∏à‡∏≤‡∏∞‡∏Ç‡πà‡∏≤‡∏ß" ‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ üõ°Ô∏è<br /><small
            >(PR-Crisis Sentinel)</small
          >
        </h1>
        <nav>
          <a href="{{ url_for('index') }}" class="nav-link">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
          <a href="{{ url_for('about') }}" class="nav-link">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</a>
        </nav>
      </div>

      <!-- ===== START: ‡∏õ‡∏£‡∏±‡∏ö Layout ‡∏õ‡∏∏‡πà‡∏° ===== -->
      <div class="top-buttons-container">
        {% if keyword is defined and results %}
        <button id="simulation-button" class="action-btn simulation-btn">
          üîÆ ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ß‡∏¥‡∏Å‡∏§‡∏ï
        </button>

        <button id="exec-summary-button" class="action-btn exec-summary-btn">
          ü™Ñ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£
        </button>
        {% if sentiment_summary.NEGATIVE > 0 %}
        <button id="root-cause-button" class="action-btn root-cause-btn">
          üî¨ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å
        </button>
        {% endif %} {% endif %}
      </div>
      <!-- ===== END: ‡∏õ‡∏£‡∏±‡∏ö Layout ‡∏õ‡∏∏‡πà‡∏° ===== -->

      <div class="search-form-container">
        <form class="search-form" action="/analyze" method="post">
          <input
            type="text"
            id="keyword-input"
            name="keyword"
            placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏π‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á......"
            required
          />
          <button type="button" id="mic-button" title="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á">
            üé§
          </button>
          <button type="submit">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>
        </form>
      </div>

      {% if keyword is defined %} {% if results %}
      <div class="results-header">
        ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö: <strong>{{ keyword }}</strong>
      </div>
      <div class="charts-container">
        {% if wordcloud_image %}
        <div class="wordcloud-card card">
          <h3>
            ‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏ô‡∏Ç‡πà‡∏≤‡∏ß‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö
            <div class="tooltip">
              <span class="tooltip-icon">?</span
              ><span class="tooltip-text"
                >‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö</span
              >
            </div>
          </h3>
          <img
            src="{{ url_for('static', filename=wordcloud_image) }}"
            alt="Word Cloud"
          />
        </div>
        {% endif %}
        <div class="chart-card card">
          <h3>
            ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å
            <div class="tooltip">
              <span class="tooltip-icon">?</span
              ><span class="tooltip-text">‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
            </div>
          </h3>
          <canvas id="sentimentPieChart"></canvas>
        </div>
        {% if trend_message %}
        <div class="trend-card card">
          <h3>
            üìà ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö
            <div class="tooltip">
              <span class="tooltip-icon">?</span
              ><span class="tooltip-text"
                >‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 7 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</span
              >
            </div>
          </h3>
          <p class="trend-text trend-{{ trend_status }}">{{ trend_message }}</p>
          {% if trend_status == 'alert' %}
          <button id="ai-assistant-button" class="ai-assistant-btn">
            ü§ñ ‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å AI
          </button>
          {% endif %}
        </div>
        {% endif %} {% if top_keywords %}
        <div class="keyword-card card">
          <h3>
            ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏£‡πâ‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö
            <div class="tooltip">
              <span class="tooltip-icon">?</span
              ><span class="tooltip-text">‡∏™‡∏Å‡∏±‡∏î 5 ‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏à‡∏≤‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö</span>
            </div>
          </h3>
          <div class="keyword-tags">
            {% for keyword in top_keywords %}<span class="keyword-tag"
              >{{ keyword }}</span
            >{% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
      <div class="table-container">
        <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß</h3>
        <div class="table-summary">
          <span><strong>‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> {{ results|length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
          |
          <span class="sentiment-POSITIVE"
            ><strong>‡πÄ‡∏ä‡∏¥‡∏á‡∏ö‡∏ß‡∏Å:</strong> {{ sentiment_summary.POSITIVE }}</span
          >
          |
          <span class="sentiment-NEGATIVE"
            ><strong>‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö:</strong> {{ sentiment_summary.NEGATIVE }}</span
          >
          |
          <span class="sentiment-NEUTRAL"
            ><strong>‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏≤‡∏á:</strong> {{ sentiment_summary.NEUTRAL }}</span
          >
        </div>
        <table>
          <thead>
            <tr>
              <th>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô)</th>
              <th style="width: 150px">‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</th>
            </tr>
          </thead>
          <tbody>
            {% for result in results %}
            <tr>
              <td>
                <a
                  href="{{ result.url }}"
                  target="_blank"
                  rel="noopener noreferrer"
                  style="text-decoration: none; color: inherit"
                  >{{ result.title }}</a
                >
              </td>
              <td class="sentiment-{{ result.sentiment }}">
                {{ result.sentiment_thai }}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div id="pagination-wrapper" class="pagination-container"></div>
      </div>
      {% endif %} {% endif %}
    </div>

    <footer class="site-footer">
      <p>
        ¬© 2025 ‡πÅ‡∏ú‡∏ô‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏£‡∏±‡∏ï‡∏ô‡∏ö‡∏∏‡∏£‡∏µ
        ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå<br />
        ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ò‡∏¥‡∏Å‡∏≤‡∏£
      </p>
    </footer>

    <script>
                const searchForm = document.querySelector('.search-form');
                const loaderOverlay = document.getElementById('loader-overlay');

          // ===== START: ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Voice Input =====
              const micButton = document.getElementById('mic-button');
              const keywordInput = document.getElementById('keyword-input');

              // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Web Speech API ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
              if ('webkitSpeechRecognition' in window) {
                  const recognition = new webkitSpeechRecognition();
                  recognition.continuous = false; // ‡∏´‡∏¢‡∏∏‡∏î‡∏ü‡∏±‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏π‡∏î‡∏à‡∏ö
                  recognition.lang = 'th-TH';     // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
                  recognition.interimResults = false;
                  recognition.maxAlternatives = 1;

                  micButton.addEventListener('click', () => {
                      recognition.start();
                      micButton.classList.add('recording');
                      keywordInput.placeholder = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á...";
                      // ===== START: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Toast =====
      Swal.fire({
          toast: true,
          position: 'top',
          text: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á...',
          showConfirmButton: false,
          timer: 3000, // ‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÄ‡∏≠‡∏á‡πÉ‡∏ô 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
          timerProgressBar: true,
          didOpen: (toast) => {
              toast.addEventListener('mouseenter', Swal.stopTimer)
              toast.addEventListener('mouseleave', Swal.resumeTimer)
          }
      });
      // ===== END: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Toast =====
                  });



                  // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ AI ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                  recognition.onresult = function(event) {
                      const transcript = event.results[0][0].transcript;
                      keywordInput.value = transcript;
                  };

                  // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
                  recognition.onerror = function(event) {
                      console.error("Speech recognition error", event.error);
                      keywordInput.placeholder = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
                  };

                  // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏•‡∏á
                  recognition.onend = function() {
                      micButton.classList.remove('recording');
                      keywordInput.placeholder = "‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏π‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á......";
                  };

              } else {
                  // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
                  console.log("Speech Recognition Not Available");
                  micButton.style.display = 'none';
              }
              // ===== END: ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Voice Input =====

                searchForm.addEventListener('submit', function() {
                    const keywordInput = document.querySelector('input[name="keyword"]');
                    if (keywordInput.value.trim() !== '') {
                        loaderOverlay.style.display = 'flex';
                    }
                });

                {% if keyword is defined %}
                    {% if not results %}
                        Swal.fire({
                            icon: 'info',
                            title: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                            text: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö "{{ keyword }}" ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∑‡πà‡∏ô',
                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                        });
                    {% else %}
                        const pieLabels = JSON.parse('{{ labels | safe }}');
                        const pieValues = JSON.parse('{{ values | safe }}');
                        const pieCtx = document.getElementById('sentimentPieChart');
                        if (pieCtx) {
                            new Chart(pieCtx.getContext('2d'), {
                                type: 'doughnut',
                                data: {
                                    labels: pieLabels,
                                    datasets: [{
                                        data: pieValues,
                                        backgroundColor: pieLabels.map(label => {
                                            if (label === '‡∏Ç‡πà‡∏≤‡∏ß‡πÄ‡∏ä‡∏¥‡∏á‡∏ö‡∏ß‡∏Å') return 'rgba(75, 192, 192, 0.7)';
                                            if (label === '‡∏Ç‡πà‡∏≤‡∏ß‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö') return 'rgba(255, 99, 132, 0.7)';
                                            return 'rgba(201, 203, 207, 0.7)';
                                        })
                                    }]
                                }
                            });
                        }

                        const tableRows = document.querySelectorAll('.table-container tbody tr');
                        const rowsPerPage = 10;
                        let currentPage = 1;

                        function setupPagination() {
                            const pageCount = Math.ceil(tableRows.length / rowsPerPage);
                            const paginationWrapper = document.getElementById('pagination-wrapper');
                            if (!paginationWrapper) return;
                            paginationWrapper.innerHTML = '';
                            let prevButton = document.createElement('button');
                            prevButton.classList.add('pagination-btn');
                            prevButton.innerText = '‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤';
                            prevButton.addEventListener('click', () => { if (currentPage > 1) { currentPage--; displayPage(currentPage); } });
                            paginationWrapper.appendChild(prevButton);
                            for (let i = 1; i <= pageCount; i++) {
                                let btn = document.createElement('button');
                                btn.classList.add('pagination-btn');
                                btn.innerText = i;
                                btn.addEventListener('click', () => { currentPage = i; displayPage(currentPage); });
                                paginationWrapper.appendChild(btn);
                            }
                            let nextButton = document.createElement('button');
                            nextButton.classList.add('pagination-btn');
                            nextButton.innerText = '‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
                            nextButton.addEventListener('click', () => { if (currentPage < pageCount) { currentPage++; displayPage(currentPage); } });
                            paginationWrapper.appendChild(nextButton);
                        }

                        function displayPage(page) {
                            tableRows.forEach(row => row.style.display = 'none');
                            const startIndex = (page - 1) * rowsPerPage;
                            const endIndex = startIndex + rowsPerPage;
                            for (let i = startIndex; i < endIndex && i < tableRows.length; i++) { tableRows[i].style.display = ''; }
                            updateActiveButton();
                        }

                        function updateActiveButton() {
                            const buttons = document.querySelectorAll('.pagination-btn');
                            const pageCount = Math.ceil(tableRows.length / rowsPerPage);
                            buttons.forEach(button => {
                                button.classList.remove('active');
                                if (parseInt(button.innerText) === currentPage) { button.classList.add('active'); }
                            });
                            buttons[0].classList.toggle('disabled', currentPage === 1);
                            buttons[buttons.length - 1].classList.toggle('disabled', currentPage === pageCount);
                        }

                        if (tableRows.length > rowsPerPage) {
                            setupPagination();
                            displayPage(currentPage);
                        } else {
                            tableRows.forEach(row => row.style.display = '');
                        }

                        const aiButton = document.getElementById('ai-assistant-button');
                        if (aiButton) {
                            aiButton.addEventListener('click', function() {
                                Swal.fire({
                                    title: 'AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î...',
                                    text: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì',
                                    allowOutsideClick: false,
                                    didOpen: () => { Swal.showLoading(); }
                                });

                                const keyword = '{{ keyword }}';
                                const top_keywords = {{ top_keywords|tojson|safe }};
                                const negative_headlines = {{ negative_headlines_for_js|tojson|safe }};

                                fetch('/get_pr_suggestion', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({
                                        keyword: keyword,
                                        top_keywords: top_keywords,
                                        negative_headlines: negative_headlines
                                    })
                                })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.suggestion) {
                                        Swal.fire({
                                            icon: 'success',
                                            title: '‡∏£‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô',
                                            html: `<pre style="font-family: 'Sarabun', sans-serif; font-size: 1em; white-space: pre-wrap; text-align: left;">${data.suggestion}</pre>`,
                                            confirmButtonText: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å'
                                        }).then((result) => {
                                            if (result.isConfirmed) {
                                                try {
                                                    navigator.clipboard.writeText(data.suggestion).then(() => {
                                                        Swal.fire('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!', '', 'success');
                                                    });
                                                } catch (err) {
                                                    const textArea = document.createElement("textarea");
                                                    textArea.value = data.suggestion;
                                                    document.body.appendChild(textArea);
                                                    textArea.focus();
                                                    textArea.select();
                                                    try {
                                                        document.execCommand('copy');
                                                        Swal.fire('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!', '', 'success');
                                                    } catch (err) {
                                                        Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ', 'error');
                                                    }
                                                    document.body.removeChild(textArea);
                                                }
                                            }
                                        });
                                    } else {
                                        Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', data.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÑ‡∏î‡πâ', 'error');
                                    }
                                })
                                .catch(error => {
                                    Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ', 'error');
                                });
                            });
                        }

                        const summaryButton = document.getElementById('exec-summary-button');
                        if (summaryButton) {
                            summaryButton.addEventListener('click', function() {
                                Swal.fire({
                                    title: 'AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                                    text: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£',
                                    allowOutsideClick: false,
                                    didOpen: () => { Swal.showLoading(); }
                                });
                                const keyword = '{{ keyword }}';
                                const sentiment_summary = JSON.parse('{{ sentiment_summary|tojson|safe }}');
                                const top_keywords = {{ top_keywords|tojson|safe }};
                                const trend_message = '{{ trend_message }}';
                                fetch('/get_executive_summary', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({
                                        keyword: keyword,
                                        sentiment_summary: sentiment_summary,
                                        top_keywords: top_keywords,
                                        trend_message: trend_message
                                    })
                                })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.summary) {
                                        Swal.fire({
                                            icon: 'success',
                                            title: '‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£',
                                            html: `<p style="text-align: justify; line-height: 1.8;">${data.summary}</p>`,
                                            showDenyButton: true,
                                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                                            denyButtonText: `üì≤ ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Telegram`,
                                        }).then((result) => {
                                            if (result.isDenied) {
                                                sendSummaryToTelegram(keyword, data.summary);
                                            }
                                        });
                                    } else {
                                        Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', data.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ‡πÑ‡∏î‡πâ', 'error');
                                    }
                                })
                                .catch(error => {
                                    Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ', 'error');
                                });
                            });
                        }

                        function sendSummaryToTelegram(keyword, summary) {
                            Swal.fire({
                                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...',
                                allowOutsideClick: false,
                                didOpen: () => { Swal.showLoading(); }
                            });
                            fetch('/send_summary_telegram', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ keyword: keyword, summary: summary })
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    Swal.fire('‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Telegram ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß', 'success');
                                } else {
                                    Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', data.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
                                }
                            });
                        }

                        const rootCauseButton = document.getElementById('root-cause-button');
                        if (rootCauseButton) {
                            rootCauseButton.addEventListener('click', function() {
                                Swal.fire({
                                    title: 'AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢...',
                                    text: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏£‡∏≤‡∏Å‡πÄ‡∏´‡∏á‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤',
                                    allowOutsideClick: false,
                                    didOpen: () => { Swal.showLoading(); }
                                });
                                const negative_headlines = {{ negative_headlines_for_js|tojson|safe }};
                                fetch('/get_root_cause', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({ negative_headlines: negative_headlines })
                                })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.category && data.reason) {
                                        Swal.fire({
                                            icon: 'info',
                                            title: '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡πÇ‡∏î‡∏¢ AI',
                                            html: `
                                                <div style="text-align: left; padding: 0 20px;">
                                                    <h3 style="color:#2980b9; text-align:center;">${data.category}</h3>
                                                    <p style="text-align: justify;">${data.reason}</p>
                                                </div>
                                            `,
                                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                                        });
                                    } else {
                                        Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', data.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡πÑ‡∏î‡πâ', 'error');
                                    }
                                })
                                .catch(error => {
                                    Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ', 'error');
                                });
                            });
                        }
                    {% endif %}
                {% endif %}

            // ===== START: ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå =====
        const simulationButton = document.getElementById('simulation-button');
        if (simulationButton) {
            simulationButton.addEventListener('click', async function() {
                const { value: headline } = await Swal.fire({
                    title: '‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ß‡∏¥‡∏Å‡∏§‡∏ï',
                    input: 'text',
                    inputLabel: '‡∏õ‡πâ‡∏≠‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏±‡∏á‡∏ß‡∏•',
                    inputPlaceholder: '‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏ö‡∏™‡∏≤‡∏£‡∏õ‡∏ô‡πÄ‡∏õ‡∏∑‡πâ‡∏≠‡∏ô‡πÉ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏ï‡πÉ‡∏´‡∏°‡πà...',
                    showCancelButton: true,
                    confirmButtonText: '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö',
                    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
                });

                if (headline) {
                    Swal.fire({
                        title: 'AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå...',
                        text: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå',
                        allowOutsideClick: false,
                        didOpen: () => { Swal.showLoading(); }
                    });

                    fetch('/simulate_crisis', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ headline: headline })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.key_concerns && data.viral_score && data.first_action) {
                            Swal.fire({
                                icon: 'warning',
                                title: '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå',
                                html: `
                                    <div style="text-align: left; padding: 0 20px;">
                                        <h3 style="color:#2980b9;">‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:</h3>
                                        <ul>${data.key_concerns.map(item => `<li>${item}</li>`).join('')}</ul>
                                        <h3 style="color:#2980b9;">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á (1-10):</h3>
                                        <p style="font-size: 1.5em; font-weight: bold; color: #c0392b;">${data.viral_score}</p>
                                        <h3 style="color:#2980b9;">‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡πÉ‡∏ô 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÅ‡∏£‡∏Å:</h3>
                                        <p>${data.first_action}</p>
                                    </div>
                                `,
                                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                            });
                        } else {
                            Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', data.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÑ‡∏î‡πâ', 'error');
                        }
                    })
                    .catch(error => {
                        Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ', 'error');
                    });
                }
            });
        }
        // ===== END: ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå =====
    </script>
  </body>
</html>
